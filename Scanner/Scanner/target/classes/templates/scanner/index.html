<!DOCTYPE html>
<html lang="pt-br">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Leitura de C칩digo de Barras - Portaria UFN</title>
  <link rel="stylesheet" href="style.css" />
</head>
<body>
  <div class="container relative">

    <!-- Flechinha de voltar -->
    <a href="/acesso/login.html" title="Voltar"
       style="position: absolute; top: 1rem; left: 1rem; font-size: 1.2rem; color: #15d8fa; text-decoration: none;">
      游댗
    </a>

    <img class="imagem" src="/imagens/Universidade_Franciscana_logo-removebg-preview.png" alt="Logo UFN">

    <h1>Leitura de C칩digo de Barras</h1>
    <p class="info">Aponte o leitor para o c칩digo do <strong>item</strong> e do <strong>usu치rio</strong>.</p>

    <div class="scan-area" id="scanArea">Aguardando leitura...</div>

    <label for="codigoUsuario">C칩digo do Usu치rio: <span style="color: #ef4444;">*</span></label>
    <input type="text" id="codigoUsuario" placeholder="Aguardando leitura do cart칚o..." />

    <label for="codigoItem">C칩digo do Item: <span style="color: #ef4444;">*</span></label>
    <input type="text" id="codigoItem" placeholder="Aguardando leitura da etiqueta..." />

    <label for="dataHora">Data e Hora:</label>
    <input type="text" id="dataHora" readonly />

    <button onclick="confirmarMovimentacao()" id="confirmarBtn">
      Confirmar Movimenta칞칚o
    </button>

    <div id="feedback"></div>
  </div>

  <!-- Bot칚o do menu -->
  <button class="menu-btn" onclick="toggleMenu()" title="Menu">&#9776;</button>

  <!-- Menu lateral -->
  <div id="sidebar" class="sidebar">
    <a href="/usuario/cadastro">Cadastrar Usu치rio</a>
    <a href="/item/cadastro">Cadastrar Item</a>
    <a href="/" class="active">Scanner</a>
  </div>

  <!-- Overlay -->
  <div id="overlay" class="overlay" onclick="toggleMenu()"></div>

  <script>
    let scanMode = 'usuario';

    function toggleMenu() {
      document.getElementById('sidebar').classList.toggle('show');
      document.getElementById('overlay').classList.toggle('show');
      document.body.classList.toggle('menu-open');
    }

    document.addEventListener('keydown', function(e) {
      if (e.key === 'Escape' && document.getElementById('sidebar').classList.contains('show')) {
        toggleMenu();
      }
    });

    document.addEventListener("DOMContentLoaded", () => {
      atualizarDataHora();
      configurarEventos();
      atualizarScanArea();
    });

    function atualizarDataHora() {
      const agora = new Date();
      const formatado = agora.toLocaleString("pt-BR", {
        day: '2-digit',
        month: '2-digit',
        year: 'numeric',
        hour: '2-digit',
        minute: '2-digit',
        second: '2-digit'
      });
      document.getElementById("dataHora").value = formatado;
    }

    function configurarEventos() {
      const usuario = document.getElementById('codigoUsuario');
      const item = document.getElementById('codigoItem');

      usuario.addEventListener('input', () => {
        if (usuario.value.trim()) {
          usuario.classList.add('input-success');
          usuario.classList.remove('input-error');
          scanMode = 'item';
        } else {
          usuario.classList.remove('input-success');
          scanMode = 'usuario';
        }
        atualizarScanArea();
      });

      item.addEventListener('input', () => {
        if (item.value.trim()) {
          item.classList.add('input-success');
          item.classList.remove('input-error');
        } else {
          item.classList.remove('input-success');
        }
      });

      usuario.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && usuario.value.trim()) {
          item.focus();
        }
      });

      item.addEventListener('keypress', (e) => {
        if (e.key === 'Enter' && item.value.trim()) {
          confirmarMovimentacao();
        }
      });
    }

    function atualizarScanArea() {
      const area = document.getElementById("scanArea");
      if (scanMode === 'usuario') {
        area.textContent = "Aguardando leitura do CART츾O DO USU츼RIO...";
        area.classList.remove("active");
      } else {
        area.textContent = "Aguardando leitura da ETIQUETA DO ITEM...";
        area.classList.add("active");
      }
    }

    function confirmarMovimentacao() {
      const usuario = document.getElementById("codigoUsuario").value.trim();
      const item = document.getElementById("codigoItem").value.trim();
      const feedback = document.getElementById("feedback");
      const confirmarBtn = document.getElementById("confirmarBtn");

      feedback.style.display = "none";
      feedback.classList.remove('error');

      if (!usuario || !item) {
        mostrarFeedback("Por favor, preencha os c칩digos do usu치rio e do item.", 'error');
        if (!usuario) document.getElementById("codigoUsuario").classList.add('input-error');
        if (!item) document.getElementById("codigoItem").classList.add('input-error');
        return;
      }

      confirmarBtn.disabled = true;
      confirmarBtn.textContent = 'Processando...';

      setTimeout(() => {
        mostrarFeedback("Movimenta칞칚o registrada com sucesso!", 'success');
        limparFormulario();
        confirmarBtn.disabled = false;
        confirmarBtn.textContent = 'Confirmar Movimenta칞칚o';
      }, 1000);
    }

    function mostrarFeedback(mensagem, tipo) {
      const feedback = document.getElementById("feedback");
      feedback.textContent = mensagem;
      feedback.style.display = "block";
      feedback.className = tipo === 'error' ? 'error' : '';
      setTimeout(() => feedback.style.display = "none", 5000);
    }

    function limparFormulario() {
      document.getElementById("codigoUsuario").value = '';
      document.getElementById("codigoItem").value = '';
      document.getElementById("codigoUsuario").classList.remove('input-success', 'input-error');
      document.getElementById("codigoItem").classList.remove('input-success', 'input-error');
      scanMode = 'usuario';
      atualizarScanArea();
      atualizarDataHora();
      document.getElementById("codigoUsuario").focus();
    }

    setInterval(atualizarDataHora, 60000);
  </script>
</body>
</html>
